var exec = require('sync-exec');
var os = require('os');
var path = require('path');

function exe(options) {
    var cmd = options.join(' ');
    // console.log(cmd);
    var res = exec(cmd, 30000);
    if(res.stdout) {
        console.log(res.stdout);
    }
    if(res.stderr) {
        throw new Error(res.stderr);
    }
};

/**
 * 转换函数，除了ftlFile，都使用绝对路径
 * @param  {string} sourceRoot     [description]
 * @param  {string} outputRoot     [description]
 * @param  {string} ftlFile        [description]
 * @param  {string} tdd            [description]
 * @return {void}                [description]
 */
function ftl2html(sourceRoot, outputRoot, ftlFile, tdd) {
    // console.log('exec ftl');
    var jarPath = path.join(__dirname, "jar/ftl2html-core-1.0.0.jar");

    if (os.platform() === 'win32') {
        // windows
        var opts = ["cmd", "/c", "java", "-jar", jarPath];
    } else {
        // mac linux
        var opts = ["java", "-jar", jarPath];
    }
    opts.push('--sourceRoot');
    opts.push(sourceRoot);
    opts.push('--outputRoot');
    opts.push(outputRoot);
    opts.push('--ftlFile');
    opts.push(ftlFile);

    if(tdd) {
        opts.push('--tdd');
        opts.push(tdd);
    }
    
    exe(opts);
}

module.exports = ftl2html;
